.model small
.code
org 256
s:	push	cs
	pop	ds
	call	t
db	'╤е$'
t:	pop	dx
	mov	ah,9
	int	33
	mov	ah,76
	int	33
end s
▀▀▀▀▀▀▀▌
;███████  СЕГМЕНТ СТЕКА  ████████████
;      ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌          █
                                   ;█
sseg    segment PARA STACK 'stack' ;█
        dw      100 DUP (?)        ;█
sseg    ends                       ;█
                                   ;█
;████████████████████████████████████


;    ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
;█████   СЕГМЕНТ ДАННЫХ   ██████████████████████████▌
;    ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌                         ▌
dseg    segment PARA    'data'                     ;▌
Mess0   db      'Press any key or move a mouse$'   ;▌
Mess1   db      '▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄$'                 ;▌
Mess2   db      '█      █      █$'                 ;▌
Mess3   db      '█      █      █$'                 ;▌
Mess4   db      '█      █      █$'                 ;▌
Mess5   db      '█▀▀▀▀▀▀▀▀▀▀▀▀▀█$'                 ;▌
Mess6   db      '█             █$'                 ;▌
Mess7   db      '█             █$'                 ;▌
Mess8   db      '█             █$'                 ;▌
Mess9   db      '█             █$'                 ;▌
Mess10  db      '█             █$'                 ;▌
Mess11  db      '▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀$'                 ;▌                                                   ;▌
Mess12  db	'▒▒▒▒▒▒$'                          ;▌
	db      '░░░░░░$'                          ;▌                                                   ;▌
MessX	db	'X:$'                              ;▌
MessY	db	'Y:$'                              ;▌
ResAsc  db      '  ',13,10,'$'                     ;▌
ResBin  db      0                                  ;▌
TenB    db      10                                 ;▌
Ch1     dw      0               ;Состояние 1 кнопки ▌
Ch2     dw      0               ;Состояние 2 кнопки ▌
Pred_X  db      0               ;Предыдущее X       ▌
Pred_Y  db      0               ;Предыдущее Y       ▌
Pred_BX dw      0               ;Предыдущее Bx      ▌
dseg    ends                                       ;▌                                                   ;▌
;███████████████████████████████████████████████████▌


;    ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
;█████   СЕГМЕНТ КОДА     ███████████████████████████████████████████████████████
;    ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌

cseg    segment PARA    'code'
        ASSUME  cs:cseg, ds:dseg, ss:sseg

;    ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
;█████       МАКРО        ██████████████████████████████████████████████▌
;    ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌                                             ▌
                                                                       ;▌
                                                                       ;▌
                                                                       ;▌
;      ▐▀▀▀▀▀▀▀▀▀▌                                                      ▌
;      ▐   CLS   ▌               Очищает экран                          ▌
;      ▐▄▄▄▄▄▄▄▄▄▌                                                      ▌
                                                                       ;▌
cls     macro                                                          ;▌
        push	ax                                                     ;▌
	push	bx                                                     ;▌
	push	cx                                                     ;▌
	push	dx                                                     ;▌
	mov     ax,0600h        ; Номер функции "скроллинг"             ▌
        mov     bh,07           ; Атрибут экрана (черно-белый)          ▌
        mov     cx,0000         ; Левая верхняя позиция курсора         ▌
        mov     dx,184Fh        ; Правая нижняя                         ▌
        int     10h                                                    ;▌
	pop	dx                                                     ;▌
	pop	cx                                                     ;▌
	pop 	bx                                                     ;▌
	pop	ax                                                     ;▌
endm    cls                                                            ;▌
                                                                       ;▌
;       ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▌                                                 ▌
;       ▐   CUR X,Y   ▌          Позиционирует курсор в X,Y             ▌
;       ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▌                                                 ▌
                                                                       ;▌
cur     macro   stolb,strok                                            ;▌
        push	dx                                                     ;▌
	push	ax                                                     ;▌
	push	bx                                                     ;▌
	mov     dh,strok        ; Номер строки                          ▌
        mov     dl,stolb        ; Номер столбца                         ▌
        mov     ah,02           ; Номер функции "позиционирование"      ▌
        mov     bh,00           ; Эранный режим 0                       ▌
        int     10h                                                    ;▌
	pop	bx                                                     ;▌
	pop	ax                                                     ;▌
	pop	dx                                                     ;▌
endm    cur                                                            ;▌
                                                                       ;▌
;       ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌                                            ▌
;       ▐ WRITE_P Text,S   ▌          Выводит Text на экран             ▌
;       ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌          (нужно для процедур Button)       ▌
                                                                       ;▌
write_p macro   str,fgh                                                ;▌
        push	ax                                                     ;▌
	push	dx                                                     ;▌
	mov     ah,09           ; Номер функции "вывод символа"         ▌
        lea     dx,str		; Адрес сообщения в dx                  ▌
        add     dx,fgh                                                 ;▌
        int     21h                                                    ;▌
        cur     1,26            ;Позиционируем курсор за экран         ;▌
	pop	dx                                                     ;▌
	pop	ax                                                     ;▌
endm    write                                                          ;▌
                                                                       ;▌
;       ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▌                                                 ▌
;       ▐  WRITE Text ▌          Выводит Text на экран                  ▌
;       ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▌                                                 ▌
                                                                       ;▌
write   macro   stroka                                                 ;▌
        push	ax                                                     ;▌
	push	dx                                                     ;▌
	mov     ah,09           ; Номер функции "вывод символа"         ▌
        lea     dx,stroka	; Адрес сообщения в dx                  ▌
        int     21h                                                    ;▌
	pop	dx                                                     ;▌
	pop	ax                                                     ;▌
endm    write                                                          ;▌
                                                                       ;▌
;       ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌                                           ▌
;       ▐  PRINT Text, X, Y ▌    Выводит Text на экран в позицию X,Y    ▌
;       ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌                                           ▌
                                                                       ;▌
print   macro   Text,xxx,yyy                                           ;▌
        cur     xxx,yyy         ;Позиционирует курсор в xxx,yyy         ▌
        write   Text            ;Выводит Text                           ▌
endm    print                                                          ;▌
                                                                       ;▌
;███████████████████████████████████████████████████████████████████████▌



;    ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
;█████ ОСНОВНАЯ ПРОЦЕДУРА ████████████████████████████████████████████████████
;    ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌

main    proc    far
        push    ds               ;Регистр сегмента данных ds в стек
        sub     ax,ax            ;Очищаем регистр ax
        push    ax               ;    и помещаем в стек
        mov     ax,dseg          ;Адрес сегмента кода
        mov     ds,ax            ;    в ds

        cls                      ;Очистка экрана
;-------------------------------------------------------------------
	Print	Mess0,25,0       ;Печатаем Mess0 в 25 столбце, 0 строке
        call    ShowMouse        ;Показать курсор мышки
        call    Contur           ;Нарисовать контур на экране
        call    Button1          ;Поменять цвет 1 кнопки мышки
        call    Button2          ;Поменять цвет 2 кнопки мышки
	call	Buffer           ;Очистить буфер клавиатуры
                           ;▀▀▀▌
Cikl:   call    ReadKey       ;▌  Считать имеющиеся данные с клавиатуры
	jnz	Exit          ;▌  Если нажали на клавишу, то на Exit
                              ;▌
        call    ReadMouse     ;▌  Считать в bx, cx, dx информацию о мышке
                              ;▌
	call    StateMouse    ;▌  Обработать состояние мышки
        jmp     Cikl          ;▌  На начало цикла
                           ;▄▄▄▌
Exit:   call    HideMouse        ;Спрятать курсор мышки
	cls                      ;Очистка экрана

;-------------------------------------------------------------------
	ret                      ; Возврат в DOS
main    endp
;             ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
;██████████████     ПРОЦЕДУРЫ     ██████████████████████████████████████████████████████████▌
;             ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌                                             ▌


;       ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
;Contur ▐     Рисование контура мышки   ▌
;       ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌


Contur  proc    near
        print   Mess1,12,3      ;Печатаем Mess1 в 12 столбце, 3 строке
        print   Mess2,12,4      ;Печатаем Mess2 в 12 столбце, 4 строке
        print   Mess3,12,5      ;Печатаем Mess3 в 12 столбце, 5 строке
        print   Mess4,12,6      ;Печатаем Mess4 в 12 столбце, 6 строке
        print   Mess5,12,7      ;Печатаем Mess5 в 12 столбце, 7 строке
        print   Mess6,12,8      ;Печатаем Mess6 в 12 столбце, 8 строке
        print   Mess7,12,9      ;Печатаем Mess7 в 12 столбце, 9 строке
        print   Mess8,12,10     ;Печатаем Mess8 в 12 столбце, 10 строке
        print   Mess9,12,11     ;Печатаем Mess9 в 12 столбце, 11 строке
        print   Mess10,12,12    ;Печатаем Mess10 в 12 столбце, 12 строке
        print   Mess11,12,13    ;Печатаем Mess11 в 12 столбце, 13 строке
        print   MessX,17,9      ;Печатаем MessX в 17 столбце, 9 строке
        print   MessY,17,11     ;Печатаем MessY в 17 столбце, 11 строке
	ret
endp    Contur


;         ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
; Button1 ▐   Поменять цвет 1 кнопки мышки  (Ch = 0  -  темная кнопка  ▌
;         ▐                                 Ch = 7  -  светлая кнопка) ▌
;         ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌


Button1 proc    near
        cmp     Ch1,0           ;Кнопка - темная,
        je      But1            ;если да то идти на замену светлой,
        mov     Ch1,0           ;иначе заменить на темную
        jmp     Ris_Ch1         ;Идти на рисование 1 кнопки
But1:   mov     Ch1,7           ;Заменить на светлую
Ris_Ch1:cur     13,4            ;Позиционируем курсор в 13 столбец, 4 строку
        write_p Mess12,Ch1      ;Нарисовать верхнюю часть кнопки
        cur     13,5            ;Позиционируем курсор в 13 столбец, 5 строку
        write_p Mess12,Ch1      ;Нарисовать среднюю часть кнопки
        cur     13,6            ;Позиционируем курсор в 13 столбец, 6 строку
        write_p Mess12,Ch1      ;Нарисовать нижнюю часть кнопки
	ret
endp    Button1


;         ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
; Button2 ▐    Поменять цвет 2 кнопки мышки  (Ch = 0  -  темная кнопка    ▌
;         ▐                                  Ch = 7  -  светлая кнопка)   ▌
;         ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌


Button2 proc    near
        cmp     Ch2,0           ;Кнопка - темная,
        je      But2            ;если да то идти на замену светлой,
        mov     Ch2,0           ;иначе заменить на темную
        jmp     Ris_Ch2         ;Идти на рисование 2 кнопки
But2:   mov     Ch2,7           ;Заменить на светлую
Ris_Ch2:cur     20,4            ;Позиционируем курсор в 20 столбец, 4 строку
        write_p Mess12,Ch2      ;Нарисовать верхнюю часть кнопки
        cur     20,5            ;Позиционируем курсор в 20 столбец, 5 строку
        write_p Mess12,Ch2      ;Нарисовать среднюю часть кнопки
        cur     20,6            ;Позиционируем курсор в 20 столбец, 6 строку
        write_p Mess12,Ch2      ;Нарисовать нижнюю часть кнопки
	ret
endp    Button2


;              ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
;  StateMouse  ▐   Обработать состояние мышки   ▌
;              ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌


StateMouse   proc    near
        push    ax
        push    cx
	push    dx
        mov	ax,cx           ;В ax номер столбца курсора мышки
	mov	cl,3            ;Подготовка к делению на 8
	shr	ax,cl           ;Деление ax на 8
	shr	dx,cl           ;Деление dx на 8
	inc	dl              ;Увеличиваем dl и al на 1, чтобы координаты
	inc	al              ;    были 1..80, 1..20, а не 0..79, 0..19
        cmp     al,Pred_X       ;Сравниваем текущий столбец с предыдущим,
        je      L_X             ; если он не поменялся, то идти дальше,
	mov     ResBin,al       ; иначе преобразовать его в десятичный формат
	call    Bin2Asc         ;    и вывести на экран
	print 	ResAsc,20,9     ;Печатаем ResAsc в 20 столбце, 9 строке
        mov     Pred_X,al       ;Запомнить значение столбца

L_X:    cmp     dl,Pred_Y       ;Сравниваем текущую строку с предыдущей,
        je      L_Y             ; если она не поменялась, то идти дальше,
        mov     ResBin,dl       ; иначе преобразовать ее в десятичный формат
	call    Bin2Asc         ;    и вывести на экран
        print 	ResAsc,20,11    ;Печатаем ResAsc в 20 столбце, 11 строке
        mov     Pred_Y,dl       ;Запомнить значение строки

L_Y:    cmp     Pred_BX,bx      ;Сравнить предыдущее нажатие кнопок с текущим,
        je      LLL             ;  если они совпадают то идти на выход

        cmp     bx,1            ;Была ли нажата 1 кнопка,
        je      L_1_0           ; если да то поменять цвет 1 кнопки

        cmp     bx,2            ;Была ли нажата 2 кнопка
        Je      L_0_1           ; если да то поменять цвет 2 кнопки

        cmp     bx,3            ;Были ли нажаты обе кнопки
        Je      L_1_1           ; если да то поменять цвет обеих кнопок

        jmp     LLL             ;Идти на выход

L_1_0:  call    Button1         ;Поменять цвет 1 кнопки мышки
        jmp     LLL             ;Идти на выход

L_0_1:  call    Button2         ;Поменять цвет 2 кнопки мышки
        jmp     LLL             ;Идти на выход

L_1_1:  call    Button1         ;Поменять цвет 1 кнопки мышки
        call    Button2         ;Поменять цвет 2 кнопки мышки

LLL:    pop     dx
        pop     cx
        pop     ax
        cur     1,26            ;Позиционируем курсор за экран
        ret
endp    StateMouse


;            ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
; ShowMouse  ▐   Показать курсор мышки   ▌
;            ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌


ShowMouse       proc       near
        mov     ax,0001h        ;Функция нескрытого курсора
        int     33h             ;Прерывание для мышки
        ret
endp    ShowMouse


;           ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
; HideMouse ▐    Спрятать курсор мышки    ▌
;           ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌


HideMouse       proc       near
        mov     ax,0002h        ;Функция скрытого курсора
        int     33h             ;Прерывание для мышки
        ret
endp    HideMouse


;            ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
; ReadMouse  ▐   Считать в bx, cx, dx информацию о мышке   ▌
;            ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌


ReadMouse       proc       near
        push    ax
        mov     Pred_BX,bx       ;Запомнить предыдущее значение bx
                                 ;        (bx отвечает за кнопки мышки)
        mov     ax,0003h         ;Функция считывания информации о мышке
        int     33h              ;Прерывание для мышки
        pop     ax
        ret
endp    ReadMouse


;          ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
; Bin2Asc  ▐    Преобразование Bin в ASCII     ▌
;          ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌


Bin2Asc proc	near
        push	ax
	push	si
	mov	ResAsc,' '
	lea     si,ResAsc+1	; Адрес поля для правой цифры в ResAsc
        mov     ah,0
        mov     al,ResBin       ; Число для преобразования
Next2:  cmp     al,10		; Число <10 ?
        jl      Ex	        ; Да - выход
        mov     ah,0		; Очищаем часть делимого
        div     TenB            ; Делим на 10
        add     ah,30h          ; Добавляем к цифре "3"
        mov     [si],ah         ; Записываем очередной символ
        dec     si
        jmp     Next2           ; Повтор
Ex:     add     al,30h          ; Добавляем к цифре "3"
        mov     [si],al         ; Записываем последний символ
	pop	ax
	pop	si
        ret
Bin2Asc endp


;         ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
; Buffer  ▐  Очистка буфера клавиатуры  ▌
;         ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌


Buffer	proc	near
	mov	ax,0c00h        ;Функция очистки буфера клавиатуры
	int	21h
	ret
Buffer	endp


;          ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
; ReadKey  ▐    Считывает имеющиеся данные с клавиатуры, если же    ▌
;          ▐     клавиша не нажата, то устанавливает флаг zf в 0    ▌
;          ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌


ReadKey proc    near
        mov     ah,6	         ;
	mov	dl,0ffh          ;Номер функции "Ввод"
        int     21h              ;
        ret
ReadKey endp


;████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████

cseg    ends
        end     main                Title  Тест-программа для мышки
;        написал Кожевников Евгений 2 курс 21 группа, 1999г.
;      ▐▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▌
;███████  СЕГМЕНТ СТЕКА  ████████████
;      ▐▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▌          █
                                   ;█
